{% extends 'base.html' %}
{% load static %}
{% load thumbnail %}

<!DOCTYPE html>
<html lang="en">
<head>

	<!-- Meta Tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="Bootstrap 5 based Social Media Network and Community Theme">

</head>

{% block content %}
<body>
<!-- **************** MAIN CONTENT START **************** -->
<main>
  
  <!-- Container START -->
  <div class="container-fluid">
    <div class="row justify-content-between g-0">

      <!-- Sidenav START -->
      <div class="col-md-2 col-lg-3 col-xxl-4 mt-n4">
        <div class="nav-sidenav p-4 bg-mode h-100 custom-scrollbar">
          <!-- Card START -->
            <!-- Side Nav START -->
              <ul class="nav nav-link-secondary flex-column fw-bold gap-2">
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'dashboard' username=user.username %}"> <i class="bi bi-card-checklist nav-icon"></i> <span class="nav-text">Feed </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'my_profile_connections' %}"> <i class="bi bi-people nav-icon"></i> <span class="nav-text">Connections </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'user_list' %}"> <i class="bi bi-collection-fill nav-icon"></i> <span class="nav-text">Groups </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'notifications'  username=user.username %}"> <i class="bi bi-bell-fill nav-icon"></i> <span class="nav-text">Notifications </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'edit_profile' username=user.username %}"> <i class="bi bi-gear-wide-connected nav-icon"></i> <span class="nav-text">Settings </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'direct:inbox' %}"> <i class="bi bi-chat-left-text nav-icon"></i> <span class="nav-text">Messaging </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'help' %}"> <i class="bi bi-info-circle nav-icon"></i> <span class="nav-text">Help </span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'privacy' %}"> <i class="bi bi-shield-exclamation nav-icon"></i> <span class="nav-text">Privacy & terms </span></a>
                </li>
              </ul>
              <!-- Side Nav END -->
          <!-- Card body END -->
        </div>
      </div>
      <!-- Sidenav END -->

      <!-- Main content START -->
      <div class="col-md-8 col-lg-6 col-xxl-4 vstack gap-4">

        <!-- Story START -->
        <div class="d-flex gap-3 mb-n3">
          <div class="position-relative text-center">
            <!-- Card START -->
            <div class="mb-1">
              <a class="stretched-link btn btn-dark rounded-circle icon-xxl rounded-circle" href="#!"><i class="fa-solid fa-plus fs-6"></i></a>
            </div>
            <a href="#!" class="small fw-normal text-secondary">Post a story</a>
            <!-- Card END -->
          </div>
          <!-- Stories -->
          <div id="stories" class="storiesWrapper stories user-icon carousel scroll-enable"></div>
        </div>
        <!-- Story END -->

        <!-- Share feed START -->
        <div class="card card-body">
          <!-- Share feed toolbar START -->
          <ul class="nav nav-pills nav-stack small fw-normal">
            <li class="nav-item">
              <a class="nav-link bg-light py-1 px-2 mb-0" href="#!" data-bs-toggle="modal" data-bs-target="#feedActionPhoto"> <i class="bi bi-image-fill text-success pe-2"></i>Photo</a>
            </li>
            <li class="nav-item">
              <a class="nav-link bg-light py-1 px-2 mb-0" href="#!" data-bs-toggle="modal" data-bs-target="#feedActionVideo"> <i class="bi bi-camera-reels-fill text-info pe-2"></i>Video</a>
            </li>
            <li class="nav-item">
              <a href="#" class="nav-link bg-light py-1 px-2 mb-0" data-bs-toggle="modal" data-bs-target="#modalCreateEvents"> <i class="bi bi-calendar2-event-fill text-danger pe-2"></i>Event </a>
            </li>
            <li class="nav-item">
              <a class="nav-link bg-light py-1 px-2 mb-0" href="#!" data-bs-toggle="modal" data-bs-target="#modalCreateFeed"> <i class="bi bi-emoji-smile-fill text-warning pe-2"></i>Feeling /Activity</a>
            </li>
            <li class="nav-item dropdown ms-lg-auto">
              <a class="nav-link bg-light py-1 px-2 mb-0" href="#" id="feedActionShare" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-three-dots"></i>
              </a>
              <!-- Dropdown menu -->
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="feedActionShare">
                <li><a class="dropdown-item" href="#"> <i class="bi bi-envelope fa-fw pe-2"></i>Create a poll</a></li>
                <li><a class="dropdown-item" href="#"> <i class="bi bi-bookmark-check fa-fw pe-2"></i>Ask a question </a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item" href="{% url 'help' %}"> <i class="bi bi-pencil-square fa-fw pe-2"></i>Help</a></li>
              </ul>
            </li>
          </ul>
          <!-- Share feed toolbar END -->
        </div>
        <!-- Share feed END -->

        {% for post in posts %}
          {% if user.is_authenticated and user == post.user %}
						{% if not post.hidden %}
              <!-- Card feed item START -->
              <div class="card">
                <!-- Card header START -->
                <div class="card-header border-0 pb-0">
                  <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                      <!-- Avatar -->
                      <div class="avatar avatar-story me-2">
                        <a href="#!">
                          <img class="avatar-img rounded-circle" src="{% if post.user.profile.photo %}{% thumbnail post.user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}">
                        </a>
                      </div>
                      <!-- Info -->
                      <div>
                        <div class="nav nav-divider">
                          <h6 class="nav-item card-title mb-0"> <a href="{% url 'dashboard' username=user.username %}"> {{ post.user.username }} </a></h6>
                          <span class="nav-item small"> {{ post.created_ago }}</span>
                        </div>
                        <p class="mb-0 small">{{ post.location }}</p>
                      </div>
                    </div>
                    <!-- Card feed action dropdown START -->
                    <div class="dropdown">
                      <a href="#" class="text-secondary btn btn-secondary-soft-hover py-1 px-2" id="cardFeedAction" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-three-dots"></i>
                      </a>
                      <!-- Card feed action dropdown menu -->
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cardFeedAction">
                        <li><a class="dropdown-item" href="{% url 'save_post' slug=post.slug %}"> <i class="bi bi-bookmark fa-fw pe-2"></i>Save post</a></li>
                        <li><a class="dropdown-item" href="{% url 'core:hide_post' slug=post.slug %}"> <i class="bi bi-x-circle fa-fw pe-2"></i>Hide post</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-slash-circle fa-fw pe-2"></i>Block</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-flag fa-fw pe-2"></i>Report post</a></li>
                      </ul>
                    </div>
                    <!-- Card feed action dropdown END -->
                  </div>
                </div>
                <!-- Card header END -->
                <!-- Card body START -->
                <div class="card-body">
                  {% if post.image %}
                    <!-- Grid img -->
                    <a class="h-100" href="{{ post.image.url }}" data-glightbox data-gallery="image-popup">
                      <img class="card-img" src="{{ post.image.url }}" alt="{{ post.caption }}">
                    </a>
                  {% endif %}

                  {% if post.video %}
                    <div class="overflow-hidden fullscreen-video w-100">
                      <div class="player-wrapper overflow-hidden">
                        <video class="player-html" controls crossorigin="anonymous" poster="{{ post.sign.url }}">
                          <source src="{{ post.video.url }}" type="video/mp4">Your browser does not support the video tag.
                        </video	>
                      </div>
                    </div>
                  {% endif %}
                  <p>{{ post.caption }}</p><br/>
                  <a href="{% url 'core:post_detail' slug=post.slug %}">{{ post.hashtags }}</a>
                  <!-- Feed react START -->
                  <ul class="nav nav-pills nav-pills-light nav-fill nav-stack small border-top border-bottom py-1 my-3">
                    <li class="nav-item">
                      <a href="{% url 'core:post_detail' slug=post.slug %}">
                        <button style="border: none; background-color: transparent !important; color: #fff;" class="like-btn" data-post-slug="{{ post.slug }}" data-liked="{% if request.user in post.likes.all %}true{% else %}false{% endif %}">
                          {% if request.user in post.likes.all %}
                            <i style="color: red;" class="fas fa-heart"></i> <!-- Filled heart icon -->
                          {% else %}
                            <i class="far fa-heart"></i> <!-- Empty heart icon -->
                          {% endif %}
                        </button>
                      </a>          
                      <span id="likes-count-{{ post.slug }}">({{ post.likes_count }}) </span>
                    </li>
                    <li class="nav-item">
                      <form action="{% url 'core:add_comment' slug=post.slug %}" method="post">
                        {% csrf_token %}
                        <button style="background-color: transparent; border: none; color: #fff;" type="submit"><i class="bi bi-chat-fill pe-1"></i>Comments ({{ post.comments.count }})</button>
                      </form>
                    </li>
                    <!-- Card share action menu START -->
                    <li class="nav-item dropdown">
                      <a href="#" class="nav-link mb-0" id="cardShareAction" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-reply-fill flip-horizontal ps-1"></i>Share (3)
                      </a>
                      <!-- Card share action dropdown menu -->
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cardShareAction">
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-envelope fa-fw pe-2"></i>Send via Direct Message</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-bookmark-check fa-fw pe-2"></i>Bookmark </a></li>
                        <li><a class="dropdown-item" href=""> <i class="bi bi-link fa-fw pe-2"></i>Copy link to post</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-share fa-fw pe-2"></i>Share post via …</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-pencil-square fa-fw pe-2"></i>Share to News Feed</a></li>
                      </ul>
                    </li>
                    <!-- Card share action menu END -->
                    <li class="nav-item dropdown">
                      <a class="nav-link mb-0" id="cardShareAction" data-bs-toggle="dropdown" aria-expanded="false" href="#!"> <i class="bi bi-send-fill pe-1"></i>Send</a>
                      <!-- Card share action dropdown menu -->
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cardShareAction">
                        <li><a class="dropdown-item" href="https://www.instagram.com/"> <i class="bi bi-instagram fa-fw pe-2"></i>Instagram</a></li>
                        <li><a class="dropdown-item" href="https://www.facebook.com/"> <i class="bi bi-facebook fa-fw pe-2"></i>Facebook </a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-link fa-fw pe-2"></i>Copy link to post</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-share fa-fw pe-2"></i>Share post via …</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-pencil-square fa-fw pe-2"></i>Send via Direct Message</a></li>
                      </ul>
                    </li>
                  </ul>
                  <!-- Feed react START -->

                  <p>Liked by:
                    {% for user in post.likes.all %}
                      {{ user.username }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                  </p>

                  {% for comment in post.comments.all %}
                    <!-- Comment wrap START -->
                    <ul class="comment-wrap list-unstyled">
                      <!-- Comment item START -->
                      <li class="comment-item">
                        <div class="d-flex position-relative">
                          <div class="comment-line-inner"></div>
                          <!-- Avatar -->
                          <div class="avatar avatar-xs">
                            <a href="#!"><img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""></a>
                          </div>
                          <div class="ms-2">
                            <!-- Comment by -->
                            <div class="bg-light rounded-start-top-0 p-3 rounded">
                              <div class="d-flex justify-content-between">
                                <h6 class="mb-1"> <a href="{% url 'dashboard' username=user.username %}"> {{ comment.user.username }} </a></h6>
                                <small class="ms-2">{{ comment.created_at }}</small>
                              </div>
                              <p class="small mb-0">{{ comment.text }}</p>
                            </div>
                            <!-- Comment react -->
                            <ul class="nav nav-divider py-2 small">
                              <li class="nav-item">
                                <a class="nav-link" href="#!"> Like (3)</a>
                              </li>
                              <li class="nav-item">
                                <a class="nav-link" href="{% url 'core:post_detail' slug=post.slug %}"> Reply</a>
                              </li>
                              <li class="nav-item">
                                <a class="nav-link" href="#!"> View 5 replies</a>
                              </li>
                            </ul>
                          </div>
                        </div>
                        {% for reply_comment in comment.get_reply_comments %}
                          <!-- Comment item nested START -->
                          <ul class="comment-item-nested list-unstyled">
                            <!-- Comment item START -->
                            <li class="comment-item">
                              <div class="comment-line-inner"></div>
                              <div class="d-flex">
                                <!-- Avatar -->
                                <div class="avatar avatar-xs">
                                  <a href="#!"><img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""></a>
                                </div>
                                <!-- Comment by -->
                                <div class="ms-2">
                                  <div class="bg-light p-3 rounded">
                                    <div class="d-flex justify-content-between">
                                      <h6 class="mb-1"> <a href="{% url 'dashboard' username=user.username %}"> {{ comment.user.username }}</a></h6>
                                      <small> {{ comment.created_at }}</small>
                                    </div>
                                    <p class="small mb-0">{{ reply_comment.text }}</p>
                                  </div>
                                  <!-- Comment react -->
                                  <ul class="nav nav-divider py-2 small">
                                    <li class="nav-item">
                                      <a class="nav-link" href="#!"> Like (5)</a>
                                    </li>
                                    <li class="nav-item">
                                      <a class="nav-link" href="#!"> Reply</a>
                                    </li>
                                  </ul>
                                </div>
                              </div>
                            </li>
                            <!-- Comment item END -->
                          </ul>
                        {% endfor %}
                      </li>
                      <!-- Comment item END -->
                    </ul>
                  {% endfor %}
                  <!-- Comment wrap END -->
                </div>
                <!-- Card body END -->
              </div>
              {% else %}
                <div style="text-align: center;" class="content">
                  <i style="font-size: 4em;" class="bi bi-clipboard-x"></i>
                  <p>You have hidden this post so this post will not be visible to you.</p>
                  <div class="d-grid mt-3">
                    <a class="btn btn-sm btn-primary-soft" href="{% url 'core:hide_post' slug=post.slug %}">Unhide Post</a>
                  </div>
                </div>
              {% endif %}
            {% else %}
              <!-- Card feed item START -->
              <div class="card">
                <!-- Card header START -->
                <div class="card-header border-0 pb-0">
                  <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                      <!-- Avatar -->
                      <div class="avatar avatar-story me-2">
                        <a href="#!"> <img class="avatar-img rounded-circle" src="{% if post.user.profile.photo %}{% thumbnail post.user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""> </a>
                      </div>
                      <!-- Info -->
                      <div>
                        <div class="nav nav-divider">
                          <h6 class="nav-item card-title mb-0"> <a href="{% url 'core:post_detail' slug=post.slug %}"> {{ post.user.username }} </a></h6>
                          <span class="nav-item small"> {{ post.created_ago }}</span>
                        </div>
                        <p class="mb-0 small">{{ post.location }}</p>
                      </div>
                    </div>
                    <!-- Card feed action dropdown START -->
                    <div class="dropdown">
                      <a href="#" class="text-secondary btn btn-secondary-soft-hover py-1 px-2" id="cardFeedAction" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-three-dots"></i>
                      </a>
                      <!-- Card feed action dropdown menu -->
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cardFeedAction">
                        <li><a class="dropdown-item" href="{% url 'save_post' slug=post.slug %}"> <i class="bi bi-bookmark fa-fw pe-2"></i>Save post</a></li>
                        <li><a class="dropdown-item" href="{% url 'core:hide_post' slug=post.slug %}"> <i class="bi bi-x-circle fa-fw pe-2"></i>Hide post</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-slash-circle fa-fw pe-2"></i>Block</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-flag fa-fw pe-2"></i>Report post</a></li>
                      </ul>
                    </div>
                    <!-- Card feed action dropdown END -->
                  </div>
                </div>
                <!-- Card header END -->
                <!-- Card body START -->
                <div class="card-body">
                  {% if post.image %}
                    <img class="card-img" src="{{ post.image.url }}" alt="{{ post.caption }}">
                  {% endif %}

                  {% if post.video %}
                    <div class="overflow-hidden fullscreen-video w-100">
                      <div class="player-wrapper overflow-hidden">
                        <video class="player-html" controls crossorigin="anonymous" poster="{{ post.sign.url }}">
                          <source src="{{ post.video.url }}" type="video/mp4">Your browser does not support the video tag.
                        </video	>
                      </div>
                    </div>
                  {% endif %}

                  <div style="position: relative; top: 5px;" class="d-md-flex align-items-center mb-4 border-top border-bottom">Liked by:
                    <div style="position: relative; top: 7px; left: 5px;">
                      <!-- Info -->
                      <div class="w-100">
                        <!-- Connections START -->
                        <ul class="avatar-group mt-1 list-unstyled align-items-sm-center">
                          {% for user in post.likes.all %}
                            <li class="avatar avatar-xxs">
                              <img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt="avatar">
                            </li>
                          {% endfor %}
                        </ul>
                        <!-- Connections END -->
                      </div>
                    </div>
                  </div>

                  <p>{{ post.caption }}</p><br/>
                  <a href="{% url 'core:post_detail' slug=post.slug %}">{{ post.hashtags }}</a>
                  <!-- Feed react START -->
                  <ul class="nav nav-pills nav-pills-light nav-fill nav-stack small border-top border-bottom py-1 my-3">
                    <li class="nav-item">
                      <form method="post" action="{% url 'core:like_post' slug=post.slug %}">
                        {% csrf_token %}
                        <button style="border: none; background-color: transparent !important;" type="submit">
                          <a class="nav-link mb-0 active" href="#!" data-bs-container="body" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" data-bs-custom-class="tooltip-text-start"> 
                            <i class="bi bi-heart pe-1"></i>
                            Liked ({{ post.likes.count }})
                          </a>
                        </button>
                      </form>
                    </li>
                    <li class="nav-item">
                      <form action="{% url 'core:add_comment' slug=post.slug %}" method="post">
                        {% csrf_token %}
                        <button style="background-color: transparent; border: none; color: #fff;" type="submit"><i class="bi bi-chat-fill pe-1"></i>Comments ({{ post.comments.count }})</button>
                      </form>
                    </li>
                    <!-- Card share action menu START -->
                    <li class="nav-item dropdown">
                      <a href="#" class="nav-link mb-0" id="cardShareAction" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-reply-fill flip-horizontal ps-1"></i>Share (3)
                      </a>
                        <!-- Card share action dropdown menu -->
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cardShareAction">
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-envelope fa-fw pe-2"></i>Send via Direct Message</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-bookmark-check fa-fw pe-2"></i>Bookmark </a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-link fa-fw pe-2"></i>Copy link to post</a></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-share fa-fw pe-2"></i>Share post via …</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"> <i class="bi bi-pencil-square fa-fw pe-2"></i>Share to News Feed</a></li>
                      </ul>
                    </li>
                    <!-- Card share action menu END -->
                    <li class="nav-item">
                      <a class="nav-link mb-0" href="#!"> <i class="bi bi-send-fill pe-1"></i>Send</a>
                    </li>
                  </ul>
                  <!-- Feed react START -->

                  {% for comment in post.comments.all %}
                    <!-- Comment wrap START -->
                    <ul class="comment-wrap list-unstyled">
                      <!-- Comment item START -->
                      <li class="comment-item">
                        <div class="d-flex position-relative">
                          <div class="comment-line-inner"></div>
                          <!-- Avatar -->
                          <div class="avatar avatar-xs">
                            <a href="#!"><img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""></a>
                          </div>
                          <div class="ms-2">
                            <!-- Comment by -->
                            <div class="bg-light rounded-start-top-0 p-3 rounded">
                              <div class="d-flex justify-content-between">
                                <h6 class="mb-1"> <a href="#!"> {{ comment.user.username }} </a></h6>
                                <small class="ms-2">{{ comment.created_at }}</small>
                              </div>
                              <p class="small mb-0">{{ comment.text }}</p>
                            </div>
                            <!-- Comment react -->
                            <ul class="nav nav-divider py-2 small">
                              <li class="nav-item">
                                <a class="nav-link" href="#!"> Like (3)</a>
                              </li>
                              <li class="nav-item">
                                <a class="nav-link" href="{% url 'core:post_detail' slug=post.slug %}"> Reply</a>
                              </li>
                              <li class="nav-item">
                                <a class="nav-link" href="#!"> View 5 replies</a>
                              </li>
                            </ul>
                          </div>
                        </div>
                        {% for reply_comment in comment.get_reply_comments %}
                          <!-- Comment item nested START -->
                          <ul class="comment-item-nested list-unstyled">
                            <!-- Comment item START -->
                            <li class="comment-item">
                              <div class="comment-line-inner"></div>
                              <div class="d-flex">
                                <!-- Avatar -->
                                <div class="avatar avatar-xs">
                                  <a href="#!"><img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""></a>
                                </div>
                                <!-- Comment by -->
                                <div class="ms-2">
                                  <div class="bg-light p-3 rounded">
                                    <div class="d-flex justify-content-between">
                                      <h6 class="mb-1"> <a href="#!"> {{ comment.user.username }} </a> </h6>
                                      <small>{{ comment.created_at }}</small>
                                    </div>
                                    <p class="small mb-0">{{ reply_comment.text }}</p>
                                  </div>
                                  <!-- Comment react -->
                                  <ul class="nav nav-divider py-2 small">
                                    <li class="nav-item">
                                      <a class="nav-link" href="#!"> Like (5)</a>
                                    </li>
                                    <li class="nav-item">
                                      <a class="nav-link" href="#!"> Reply</a>
                                    </li>
                                  </ul>
                                </div>
                              </div>
                            </li>
                            <!-- Comment item END -->
                          </ul>
                        {% endfor %}
                      </li>
                      <!-- Comment item END -->
                    </ul>
                  {% endfor %}
                  <!-- Comment wrap END -->
                </div>
                <!-- Card body END -->
              </div>
            {% endif %}
          {% endfor %}
      </div>
      <!-- Main content END -->

      <!-- Right sidebar START -->
      <div class="col-md-2 col-lg-3 col-xxl-4">
        
        <!-- Chat sidebar START -->
        <div class="sidebar-end p-4 bg-mode custom-scrollbar h-100">

          <div class="sidebar-end-alignment d-flex justify-content-center flex-column">

           <!-- Right sidebar toggle -->
           <div class="d-flex gap-2 align-items-center">
            <a class="btn p-0 text-secondary sidebar-end-toggle d-none d-lg-flex">
              <i class="bi bi-justify-left fs-3"></i>
            </a>
            <h5 class="contact-title mb-0">Contacts</h5>
          </div>
  
            <!-- Search contact START -->
            <form class="contact-search rounded position-relative">
              <input class="form-control bg-light" type="search" placeholder="Search..." aria-label="Search">
            </form>
            <!-- Search contact END -->
            {% for message in messages %}
              <ul class="list-unstyled">
                <!-- Contact item -->
                <li class="mt-3 hstack gap-3 align-items-center position-relative toast-btn" data-target="chatToast">
                  <!-- Avatar -->
                  <div class="avatar avatar-xs">
                    <a href="{% url 'direct:directs' message.user.username %}"><img class="avatar-img rounded-circle" src="{% if message.user.profile.photo %}{% thumbnail message.user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""></a>
                  </div>
                  <!-- Info -->
                  <div class="overflow-hidden contact-name">
                    <a class="h6 mb-0" href="#!">{{ message.user.first_name }} {{ message.user.last_name }} </a>
                  </div>
                  <!-- Chat time -->
                  <div class="contact-status ms-auto fs-3"> <i class="bi bi-dot text-success"></i> </div>
                </li>
              </ul>
            {% endfor %}
          </div>
          <!-- Offcanvas body END -->
        </div>
        <!-- Chat sidebar END -->
      </div>
      <!-- Right sidebar END -->

    </div> <!-- Row END -->
  </div>
  <!-- Container END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- Modal create Feed START -->
<div class="modal fade" id="modalCreateFeed" tabindex="-1" aria-labelledby="modalLabelCreateFeed" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">
      <!-- Modal feed header START -->
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabelCreateFeed">Create post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <!-- Modal feed header END -->

      <!-- Modal feed body START -->
      <div class="modal-body">
         <!-- Add Feed -->
         <div class="d-flex mb-3">
          <!-- Avatar -->
          <div class="avatar avatar-xs me-2">
            <img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt="">
          </div>
          <!-- Feed box  -->
          <form class="w-100">
            <textarea class="form-control pe-4 fs-3 lh-1 border-0" rows="4" placeholder="Share your thoughts..." autofocus></textarea>
          </form>
        </div>
        <!-- Feed rect START -->
        <div class="hstack gap-2">
          <a class="icon-md bg-success bg-opacity-10 text-success rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Photo"> <i class="bi bi-image-fill"></i> </a>
          <a class="icon-md bg-info bg-opacity-10 text-info rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Video"> <i class="bi bi-camera-reels-fill"></i> </a>
          <a class="icon-md bg-danger bg-opacity-10 text-danger rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Events"> <i class="bi bi-calendar2-event-fill"></i> </a>
          <a class="icon-md bg-warning bg-opacity-10 text-warning rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Feeling/Activity"> <i class="bi bi-emoji-smile-fill"></i> </a>
          <a class="icon-md bg-light text-secondary rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Check in"> <i class="bi bi-geo-alt-fill"></i> </a>
          <a class="icon-md bg-primary bg-opacity-10 text-primary rounded-circle" href="#" data-bs-toggle="tooltip" data-bs-placement="top" title="Tag people on top"> <i class="bi bi-tag-fill"></i> </a>
        </div>
        <!-- Feed rect END -->
      </div>
      <!-- Modal feed body END -->

      <!-- Modal feed footer -->
      <div class="modal-footer row justify-content-between">
        <!-- Select -->
        <div class="col-lg-3">
          <select class="form-select js-choice" data-position="top" data-search-enabled="false">
            <option value="PB">Public</option>
            <option value="PV">Friends</option>
            <option value="PV">Only me</option>
            <option value="PV">Custom</option>
          </select>
        </div>
        <!-- Button -->
        <div class="col-lg-8 text-sm-end">
          <button type="button" class="btn btn-danger-soft me-2"> <i class="bi bi-camera-video-fill pe-1"></i> Live video</button>
          <button type="button" class="btn btn-success-soft">Post</button>
        </div>
      </div>
      <!-- Modal feed footer -->

    </div>
  </div>
</div>
<!-- Modal create feed END -->

<form method="post" enctype="multipart/form-data">
	<!-- Modal create Feed photo START -->
	<div class="modal fade" id="feedActionPhoto" tabindex="-1" aria-labelledby="feedActionPhotoLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<!-- Modal feed header START -->
				<div class="modal-header">
					<h5 class="modal-title" id="feedActionPhotoLabel">Photoli post yaratish</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<!-- Modal feed header END -->

					<!-- Modal feed body START -->
					<div class="modal-body">
						<!-- Add Feed -->
						<div class="mb-3">
							<!-- Feed box  -->
							<form class="w-100">
								{% csrf_token %}
								<div class="d-flex">
                  <div class="avatar me-2">
                    <a href="#!"> <img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""> </a>
                  </div>
                  {{ form.caption }}
                </div><br>
								{{ form.hashtags }}<br>
								{{ form.location }}<br>
							</form>
						</div>

					<!-- Dropzone photo START -->
					<div>
						<label class="form-label">Photo yuklash</label>
						<div class="dropzone dropzone-default card shadow-none" data-dropzone='{"maxFiles":2}'>
							<div class="dz-message">
								<label class="form-label">Photoni yuklash</label>
								{{ form.image }}
							</div>
						</div>
					</div>
					<!-- Dropzone photo END -->

					</div>
					<!-- Modal feed body END -->

					<!-- Modal feed footer -->
					<div class="modal-footer ">
						<!-- Button -->
							<button type="submit" class="btn btn-success-soft">Postni yuklash</button>
					</div>
					<!-- Modal feed footer -->
			</div>
		</div>
	</div>
	<!-- Modal create Feed photo END -->
</form>

<!-- Modal create Feed video START -->
<form method="post" enctype="multipart/form-data">
	<div class="modal fade" id="feedActionVideo" tabindex="-1" aria-labelledby="feedActionVideoLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<!-- Modal feed header START -->
				<div class="modal-header">
					<h5 class="modal-title" id="feedActionVideoLabel">Videoli post yaratish</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<!-- Modal feed header END -->

				<!-- Modal feed body START -->
				<div class="modal-body">
					<!-- Add Feed -->
					<div class="mb-3">
						<!-- Feed box  -->
						<form class="w-100">
							{% csrf_token %}
							<div class="d-flex">
                <div class="avatar me-2">
                  <a href="#!"> <img class="avatar-img rounded-circle" src="{% if user.profile.photo %}{% thumbnail user.profile.photo 180x180 %}{% else %}../static/profile.gif{% endif %}" alt=""> </a>
                </div>
                {{ form.caption }}
              </div><br>
							{{ form.hashtags }}<br>
							{{ form.location }}<br>
						</form>
					</div>

					<!-- Dropzone photo START -->
					<div>
						<label class="form-label">Video yuklash</label>
						<div class="dropzone dropzone-default card shadow-none" data-dropzone='{"maxFiles":2}'>
							<div class="dz-message">
								<label class="form-label">Videoni yuklash</label>
								{{ form.video }}
							</div>
						</div>
					</div>

          <div>
						<label class="form-label">Belgi yuklash</label>
						<div class="dropzone dropzone-default card shadow-none" data-dropzone='{"maxFiles":2}'>
							<div class="dz-message">
								<label class="form-label">Belgi yuklash</label>
								{{ form.sign }}
							</div>
						</div>
					</div>
					<!-- Dropzone photo END -->
				</div>
				<!-- Modal feed body END -->

				<!-- Modal feed footer -->
				<div class="modal-footer">
					<!-- Button -->
					<button type="submit" class="btn btn-success-soft">Postni yuklash</button>
				</div>
				<!-- Modal feed footer -->
			</div>
		</div>
	</div>
</form>
<!-- Modal create Feed video END -->
 
<script>
	let sessionKey = '{{ request.session.session_key }}';
  let currentUser = '{{ request.user.username }}';
</script>

<script>

function copyPostUrl() {
      // Get the post URL from the data attribute
      var postUrl = document.getElementById("copyButton").getAttribute("data-post-url");

      // Create a temporary input element
      var tempInput = document.createElement("input");
      tempInput.value = postUrl;
      document.body.appendChild(tempInput);

      // Select the input value and copy it to the clipboard
      tempInput.select();
      document.execCommand("copy");

      // Remove the temporary input element
      document.body.removeChild(tempInput);

      // Alert or notify the user that the URL has been copied
      alert("Post URL copied to clipboard: " + postUrl);
    }

    // Assuming you have a button or link to hide/unhide posts
    document.getElementById('hidePostButton').addEventListener('click', function() {
        // Replace this with the actual post ID and update the URL accordingly
        var postID = 1;

        fetch(`/hide_post/${postID}/`)
            .then(response => response.json())
            .then(data => {
                console.log(data);
                // Handle the response accordingly, update the UI, etc.
            })
            .catch(error => console.error('Error:', error));
    });

    $(document).ready(function () {
      $.ajaxSetup({
        headers: {
          'X-CSRFToken': $('input[name=csrfmiddlewaretoken]').val()
        }
      });

      $('.like-btn').on('click', function () {
        var button = $(this);
        var postSlug = button.data('post-slug');
        var liked = button.data('liked') === 'true';

        console.log('postSlug:', postSlug);

        $.post('/like-post/' + postSlug + '/', {}, function (data) {
          if (data.error) {
            console.error('Error during like request:', data.error);
            return;
          }

          if (data.liked) {
            // Update the like status
            button.find('.far').show(); // Show empty heart icon
            button.find('.fas').hide(); // Hide filled heart icon
          } else {
            // Update the like status
            button.find('.far').hide(); // Hide empty heart icon
            button.find('.fas').show(); // Show filled heart icon
          }

          // Update the likes count
          $('#likes-count-' + postSlug).text(data.likes_count + ' likes');
        }).fail(function(xhr, status, error) {
          console.error('AJAX request failed:', status, error);
        });
      });
    });

</script>

</body>
{% endblock %}

{% block domready %}
	const url = '{% url "user_follow" %}';
	var options = {
		method: 'POST',
		headers: {'X-CSRFToken': csrftoken},
		mode: 'same-origin'
	}

	document.querySelector('a.follow')
			.addEventListener('click', function(e){
		e.preventDefault();
		var followButton = this;

		// add request body
		var formData = new FormData();
		formData.append('id', followButton.dataset.id);
		formData.append('action', followButton.dataset.action);
		options['body'] = formData;

		// send HTTP request
		fetch(url, options)
		.then(response => response.json())
		.then(data => {
		if (data['status'] === 'ok')
		{
			var previousAction = followButton.dataset.action;

			// toggle button text and data-action
			var action = previousAction === 'follow' ? 'unfollow' : 'follow';
			followButton.dataset.action = action;
			followButton.innerHTML = action;

			// update follower count
			var followerCount = document.querySelector('span.count .total');
			var totalFollowers = parseInt(followerCount.innerHTML);
			followerCount.innerHTML = previousAction === 'follow' ? totalFollowers + 1 : totalFollowers - 1;
		}
		})
	});
{% endblock %}

</html>